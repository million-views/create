{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.million-views.dev/create/template.v1.json",
  "title": "Template Manifest V1.0 (Registry + UI)",
  "description": "Defines a template's infrastructure stack, feature hints, and configuration variables.",
  "type": "object",
  "required": ["schemaVersion", "id", "placeholders"],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "const": "1.0.0",
      "description": "Must be exactly 1.0.0"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+/[a-z0-9-]+$",
      "description": "Unique identifier (e.g., author/template-name)"
    },
    "name": { "type": "string", "maxLength": 120 },
    "description": { "type": "string", "maxLength": 500 },
    
    "placeholders": {
      "type": "object",
      "description": "THE REGISTRY. Populated by 'make-template convert'. A flat dictionary of all variables.",
      "patternProperties": {
        "^[A-Z0-9_]+$": {
          "type": "object",
          "required": ["description"],
          "properties": {
            "description": { "type": "string" },
            "default": { "type": ["string", "number", "boolean"] },
            "type": { 
              "type": "string", 
              "enum": ["text", "number", "boolean", "email", "password", "url"],
              "default": "text"
            },
            "required": { "type": "boolean", "default": true },
            "secure": { "type": "boolean", "default": false }
          },
          "additionalProperties": false
        }
      }
    },

    "dimensions": {
      "type": "object",
      "description": "Infrastructure choices (Stack).",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "required": ["options"],
          "properties": {
            "label": { "type": "string", "description": "Header label in the UI" },
            "display": {
              "type": "object",
              "properties": {
                "variant": { "enum": ["card-grid", "list-selection", "dropdown"], "default": "list-selection" },
                "icon": { "type": "string" }
              }
            },
            "options": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["id"],
                "properties": {
                  "id": { "type": "string" },
                  "label": { "type": "string" },
                  "desc": { "type": "string" },
                  "icon": { "type": "string" },
                  "placeholders": { "$ref": "#/$defs/placeholderRefList" }
                }
              }
            }
          }
        }
      }
    },

    "hints": {
      "type": "array",
      "description": "Feature choices (White-labelling/Content).",
      "items": {
        "type": "object",
        "required": ["id", "label", "needs"],
        "properties": {
          "id": { "type": "string" },
          "label": { "type": "string" },
          "description": { "type": "string" },
          "icon": { "type": "string" },
          "needs": { "$ref": "#/$defs/capabilityNeeds" },
          "placeholders": { "$ref": "#/$defs/placeholderRefList" }
        }
      }
    },

    "gates": {
      "type": "object",
      "description": "Compatibility rules between dimensions.",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "patternProperties": {
            "^[a-z0-9-]+$": {
              "type": "object",
              "patternProperties": {
                "^[a-z_]+$": { "type": "array", "items": { "type": "string" } }
              }
            }
          }
        }
      }
    }
  },
  "$defs": {
    "placeholderKey": {
      "type": "string",
      "pattern": "^[A-Z0-9_]+$",
      "description": "A reference to a key in the placeholders registry."
    },
    "placeholderRefList": {
      "type": "array",
      "description": "List of placeholder keys (from registry) required by this item.",
      "items": { "$ref": "#/$defs/placeholderKey" },
      "uniqueItems": true
    },
    "capabilityNeeds": {
      "type": "object",
      "description": "Defining what infrastructure capabilities this feature requires.",
      "patternProperties": {
        "^[a-z_]+$": { "enum": ["required", "optional", "none"] }
      }
    }
  }
}